/**
 * @author Spiff Jekey-Green
 * @license MIT
 */
"use strict";!function(s){function e(s,e){return e.map(e=>{for(let r=1;r<s.length;r++)e=e.replace(`%${r}`,s[r]);return e})}const r=new class{constructor(){this.__Markers=Object.create(null),this.__Rules=Object.create(null),this.__Answers=Object.create(null),this.addRule=this.addRule.bind(this),this.addAnswer=this.addAnswer.bind(this),this.train=this.train.bind(this),this.process=this.process.bind(this),this.converse=this.converse.bind(this)}addRule(s,e){this.__Markers[e]?this.__Markers[e]+=`|${s}`:this.__Markers[e]=s,this.__Answers[e]||(this.__Answers[e]=Array())}addAnswer(s,e){if(!this.__Answers[s])throw new Error(`Sorry '${s} does not exist`);this.__Answers[s].push(e)}train(){for(let s in this.__Markers)this.__Rules[s]=new RegExp(this.__Markers[s],"gim")}process(s){const r=Object.create(null);r.utterance=s,r.possibleAnswers=Array(),r.classifications=Object.create(null);for(let t in this.__Rules){let i=this.__Rules[t].exec(s);i&&(r.classifications[t]=i,r.possibleAnswers.push(e(i,this.__Answers[t])))}var t,i;return r.possibleAnswers=function s(e){let r=[];return e.forEach(e=>{Array.isArray(e)?r.push(...s(e)):r.push(e)}),r}(r.possibleAnswers),r.answer=r.possibleAnswers[(t=0,i=r.possibleAnswers.length-1,Math.floor(Math.random()*(i-t+1)+t))],r}converse(s){if(process){const e=require("readline"),r=require("chalk"),t=e.createInterface({input:process.stdin,output:process.stdout});s?s(this):function s(e,i="> "){t.question(i,n=>{const o=e.process(n);o.answer?(process.stdout.write(r.yellow(o.answer)+"\n"),n.includes("bye")&&(t.close(),process.exit()),s(e,i)):(process.stdout.write("Sorry please could you rephrase that?\n"),s(e,i))})}(this)}else s()}};s.bot=r,s.r=String.raw}(window);